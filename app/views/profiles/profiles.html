<!-- 
 File: profiles.html
 * Copyright (c) 2013-2016
 * Centre National d’Enseignement à Distance (Cned), Boulevard Nicephore Niepce, 86360 CHASSENEUIL-DU-POITOU, France
 * (direction-innovation@cned.fr)
 *
 * GNU Affero General Public License (AGPL) version 3.0 or later version
 *
 * This file is part of a program which is free software: you can
 * redistribute it and/or modify it under the terms of the
 * GNU Affero General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
 * GNU Affero General Public License for more details.
 *
 * You should have received a copy of the GNU Affero General Public
 * License along with this program.
 * If not, see <http://www.gnu.org/licenses/>.
 -->
<h1 id="titreProfile" class="animated fadeInLeft" translate>Profils</h1>
<div class="content" id="global_container">
    <div id="profilePage" data-ng-init="initProfil()" document-methodes="" body-classes=""
         class="doc-General">
        <div class="alert-block alert-success alert-dismissable" id="addPanel" style="display: none;">
            <strong>{{successAdd | translate}}</strong>
        </div>
        <div class="alert-block alert-success alert-dismissable" id="defaultProfile" style="display: none;">
            <strong>{{successDefault | translate}}</strong>
        </div>
        <div class="alert-block alert-success alert-dismissable" id="defaultProfileCancel" style="display: none;">
            <strong>{{successDefault | translate}}</strong>
        </div>
        <div class="alert-block alert-success alert-dismissable" id="editPanel" style="display: none;">
            <strong>{{successMod | translate}}</strong>
        </div>
        <div class="alert-block alert-success" id="okEmail" data-ng-show="envoiMailOk">
            Email envoyé avec succès !
        </div>
        <div class="alert-block alert-success" id="msgSuccess" data-ng-show="msgSuccess">
            {{msgSuccess}}
        </div>
        <div class="alert-block alert-danger" id="msgError" ng-if="msgError">
            {{msgError}}
        </div>
        <div class="head_section">
            <input type="text" class="serach_field pull-left" data-ng-model="query" id="" name=""
                   data-ng-change="specificFilter()" placeholder="Recherche un profil ..."/>
            <button class="add_profile grey_btn pull-right" data-ng-click="create()" translate
                    title="{{'Ajouter un profil' | translate}}" name="add_profile">
                Ajouter un profil
            </button>
        </div>
        <table>
            <thead>
            <tr>
                <th>
                    <span class="cursor-pointer" data-ng-click="sortType = 'nom'; sortReverse = !sortReverse">
                        nom
                        <i class="fa" aria-hidden="true" data-ng-if="sortType === 'nom'"
                           data-ng-class="{'fa-sort-asc': sortReverse, 'fa-sort-desc': !sortReverse}"></i>
                    </span>
                </th>
                <th>descriptif</th>
                <th>propriétaire</th>
                <th>
                    <span class="cursor-pointer" data-ng-click="sortType = 'updated'; sortReverse = !sortReverse">
                        date
                        <i class="fa" aria-hidden="true" data-ng-if="sortType === 'updated'"
                           data-ng-class="{'fa-sort-asc': sortReverse, 'fa-sort-desc': !sortReverse}"></i>
                    </span>
                </th>
                <th data-ng-show="admin">par défaut</th>
                <th class="action_zone">action</th>
            </tr>
            </thead>
            <tbody data-ng-repeat="profile in profiles | orderBy:sortType:sortReverse track by $index"
                   data-ng-show="profile.showed">
            <tr>
                <td class="profile_name">
                            <span data-ng-if="isFavourite(profile)">
                                <i class="fa fa-star"></i>
                            </span>
                    <span data-ng-if="isDelegated(profile)">
                                <i class="fa fa-user"></i>
                            </span>
                    {{ profile.nom }}
                </td>
                <td class="profil_desc">
                    {{ profile.descriptif }}
                </td>
                <td class="centering">
                    {{displayOwner(profile)}}
                </td>
                <td class="centering">{{ profile.updated | date: configuration.DATE_PATTERN}}</td>
                <td data-ng-show="admin" class="text-center">
                    <div data-ng-if="isDefault(profile)">
                        <i class="fa fa-check"></i>
                    </div>
                    <div data-ng-if="!isDefault(profile)">
                        <i class="fa fa-times"></i>
                    </div>
                </td>
                <td class="action_area centering">
                    <button type="button" class="action_btn" action-profil=""
                            data-show="{{profile._id | md5Filter}}" data-shown="false" name="profile_action_btn">
                        &nbsp;
                    </button>
                    <ul class="action_list" data-show="{{profile._id | md5Filter}}">
                        <li class="setting_item"
                            data-ng-hide="profile.state === 'favoris' || isOwnerDelagate(profile) || profile.state == 'default'">
                            <a href="" title="{{'Modifier' | translate}}"
                               data-ng-click="update(profile);" name="edit_profile">Modifier</a>
                        </li>
                        <li data-ng-if="admin && isDefault(profile) && isDeletableIHM(profile)"
                            class="default_profil">
                            <a href="" title="Retirer profil par défaut" data-ng-click="retirerParDefaut(profile)">
                                Retirer profil par défaut
                            </a>
                        </li>
                        <li data-ng-if="admin && !isDefault(profile) && isDeletableIHM(profile)"
                            class="default_profil">
                            <a href="" title="Profil par défaut" data-ng-click="mettreParDefaut(profile)">
                                Profil par défaut
                            </a>
                        </li>
                        <li class="duplicating_item"
                            data-ng-show="profile.state == 'favoris' || profile.state == 'delegated' || profile.state == 'default'">
                            <a href title="Dupliquer" data-ng-click="duplicate(profile)">
                                Dupliquer
                            </a>
                        </li>
                        <li class="delegate" data-ng-show="isDelegatedOption(profile)">
                            <a href title="{{'Delegate' | translate}}" data-ng-click="preDeleguerProfil(profile)">
                                Déléguer
                            </a>
                        </li>
                        <li class="withdraw_delegate" data-ng-show="isAnnuleDelagate(profile)">
                            <a href title="{{'CancelDeleguation' | translate}}"
                               data-ng-click="preAnnulerDeleguerProfil(profile)">
                                Annuler la délégation
                            </a>
                        </li>
                        <li class="withdraw_delegate" data-ng-show="isOwnerDelagate(profile)">
                            <a href title="{{'RemoveDeleguation' | translate}}"
                               data-ng-click="preRetirerDeleguerProfil(profile)">
                                Retirer la délégation
                            </a>
                        </li>
                        <li class="share_item">
                            <a href data-ng-click="profilApartager(profile)" title="{{'Partager' | translate}}">
                                Partager
                            </a>
                        </li>
                        <li class="removing_item" data-ng-show="isDeletableIHM(profile)">
                            <a href data-toggle="modal"
                               data-target="#deleteModal"
                               data-dismiss="modal"
                               data-ng-click="preSupprimerProfil(profile)"
                               title="{{'Supprimer' | translate}}"
                               name="delete_profile">
                                Supprimer
                            </a>
                        </li>
                        <li class="removing_item" data-ng-show="profile.state == 'favoris'">
                            <a href
                               data-toggle="modal"
                               data-target="#deleteFavouriteModal"
                               data-dismiss="modal"
                               data-ng-click="preRemoveFavourite(profile)"
                               title="{{'Supprimer le profil' | translate}}"
                               name="delete_profile">
                                Supprimer le profil des favoris
                            </a>
                        </li>
                    </ul>
                </td>
            </tr>
            <tr>
                <td colspan="6">
                    <div class="resetAll apercu-tags" style="margin-bottom: 20px"
                         data-ng-repeat="profileTag in profile.profileTags.tags"
                         regle-style="profileTag.texte"
                         tags="profile.profileTags.tags"
                         apply-rules="forceApplyRules"
                         data-show-loader="showLoaderFromLoop($index)"
                         data-hide-loader="hideLoaderFromLoop($index, profile.profileTags.tags.length)"
                         preview="true">
                    </div>
                </td>
            </tr>
            </tbody>
        </table>


        <!-- Delete modal declaration !-->
        <div class="modal fade" id="deleteModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel"
             aria-hidden="true" data-backdrop="static" data-keyboard="false">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                        <h3 class="modal-title" id="myModalLabel">
                            Supprimer le profil
                        </h3>
                    </div>
                    <div class="modal-body adjust-modal-body">
                        <div class="info_txt">
                            <p class="text_left ajustPadding_bottom">
                                Voulez-vous supprimer le profil " <b>{{profilName}}</b> " ?
                            </p>
                        </div>
                        <p class="centering">
                            <button type="button" class="reset_btn data-ng-scope" data-dismiss="modal"
                                    title="Annuler">Non
                            </button>
                            <button type="button" class="btn_simple light_blue editionProfil data-ng-scope"
                                    data-ng-click="supprimerProfil()" data-dismiss="modal" title="Supprimer"
                                    name="delete_profile_btn">Oui
                            </button>
                        </p>
                    </div>
                </div>
                <!-- /.modal-content -->
            </div>
            <!-- /.modal-dialog -->
        </div>

        <!-- Begin Delegate Modal declaration !-->
        <div class="modal fade" id="delegateModal" tabindex="-1" role="dialog" aria-labelledby="delegateModalLabel"
             aria-hidden="true" data-backdrop="static" data-keyboard="false">
            <div class="modal-dialog" id="modalContent">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close"
                                data-dismiss="modal" aria-hidden="true">&times;</button>
                        <h3 class="modal-title" id="delegateModalLabel">Déléguer un
                            profil</h3>
                    </div>
                    <div data-ng-show="errorMsg" class="alert-block alert-danger">{{errorMsg}}</div>
                    <div class="modal-body adjust-modal-body">
                        <div class="row-fluid span6">
                            <div class="tab-content">
                                <div class="tab-pane active" id="document" data-ng-form="delegateformValidation">
                                    <form class="form-horizontal" role="form" id="delegate" name="delegate">
                                        <fieldset class="padding_large" data-ng-show="!successMsg">
                                            <p class="controls_zone">
                                                <label for="delegateEmail" class="simple_label"><span>Email
														:</span> <span class="required"> *</span></label>
                                                <input type="text" class="" id="delegateEmail"
                                                       placeholder="Entrer l'email du destinataire"
                                                       data-ng-model="delegateEmail" required>
                                            </p>
                                        </fieldset>
                                        <div class="centering" id="ProfileButtons">
                                            <button type="button" class="reset_btn" data-dismiss="modal"
                                                    title="Annuler">Annuler
                                            </button>
                                            <button type="button" class="btn_simple light_blue"
                                                    data-ng-click="deleguerProfil()" title="Envoyer">Envoyer
                                            </button>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- /.modal-content -->
                </div>
                <!-- /.modal-dialog -->
            </div>
            <!-- /.modal -->
        </div>
        <!-- End Delegate Modal declaration !-->
        <!-- Begin Remove Delegate Modal declaration !-->
        <div class="modal fade" id="retirerDelegateModal" tabindex="-1" role="dialog"
             aria-labelledby="delegateModalLabel" aria-hidden="true" data-backdrop="static" data-keyboard="false">
            <div class="modal-dialog" id="modalContent">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                        <h3 class="modal-title" id="retireDelegateModalLabel">Retirer
                            la délégation</h3>
                    </div>
                    <div class="modal-body adjust-modal-body">
                        <div class="row-fluid span6">
                            <div class="tab-content">
                                <div class="tab-pane active" id="document" data-ng-form="delegateformValidation">
                                    <form class="form-horizontal" role="form" id="retireDelegate" name="retireDelegate">
                                        <p>Voulez-vous retirer votre délégation?</p>
                                        <div class="centering" id="ProfileButtons">
                                            <button type="button" class="reset_btn" data-dismiss="modal"
                                                    title="Annuler">Annuler
                                            </button>
                                            <button type="button" class="btn_simple light_blue" data-dismiss="modal"
                                                    data-ng-click="retireDeleguerProfil()" title="Oui">Oui
                                            </button>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- /.modal-content -->
                </div>
                <!-- /.modal-dialog -->
            </div>
            <!-- /.modal -->
        </div>
        <!-- End Remove Delegate Modal declaration !-->
        <!-- Begin Cancel Delegate Modal declaration !-->
        <div class="modal fade" id="annulerDelegateModal" tabindex="-1" role="dialog"
             aria-labelledby="delegateModalLabel" aria-hidden="true" data-backdrop="static" data-keyboard="false">
            <div class="modal-dialog" id="modalContent">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                        <h3 class="modal-title" id="annuleDelegateModalLabel">Annuler
                            la délégation</h3>
                    </div>
                    <div class="modal-body adjust-modal-body">
                        <div class="row-fluid span6">
                            <div class="tab-content">
                                <div class="tab-pane active" id="document" data-ng-form="annuleformValidation">
                                    <form class="form-horizontal" role="form" id="annuleDelegate" name="retireDelegate">
                                        <p>Voulez-vous annuler votre délégation?</p>
                                        <div class="centering" id="ProfileButtons">
                                            <button type="button" class="reset_btn" data-dismiss="modal"
                                                    title="Annuler">Annuler
                                            </button>
                                            <button type="button" class="btn_simple light_blue" data-dismiss="modal"
                                                    data-ng-click="annuleDeleguerProfil()" title="Oui">Oui
                                            </button>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- /.modal-content -->
                </div>
                <!-- /.modal-dialog -->
            </div>
            <!-- /.modal -->
        </div>
        <!-- End Cancel Delegate Modal declaration !-->

        <div class="modal fade" id="deleteFavouriteModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel"
             aria-hidden="true" data-backdrop="static" data-keyboard="false">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                        <h3 class="modal-title" id="myModalLabel">deleteFavoris</h3>
                    </div>
                    <div class="modal-body adjust-modal-body">
                        <p translate>messageSuppression</p>
                        <p class="centering">
                            <button type="button" class="reset_btn data-ng-scope" data-dismiss="modal"
                                    translate title="Annuler">Annuler
                            </button>
                            <button type="button" class="btn_simple light_blue editionProfil data-ng-scope"
                                    data-ng-click="removeFavourite()" data-dismiss="modal" translate title="Supprimer">
                                Supprimer
                            </button>
                        </p>
                    </div>
                </div>
                <!-- /.modal-content -->
            </div>
            <!-- /.modal-dialog -->
        </div>
        <!-- /.modal -->


        <div class="modal fade" id="shareModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel"
             aria-hidden="true" data-backdrop="static" data-keyboard="false">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-ng-click="clearSocialShare()" data-dismiss="modal"
                                aria-hidden="true">&times;</button>
                        <h4 class="modal-title" id="myModalLabel">Partager ce profil</h4>
                    </div>
                    <div class="modal-body">
                        <h2>
                            <span>Sélectionner un moyen pour partager ce profil</span>
                        </h2>
                        <div class="msg_error" id="erreurEmail" data-ng-show="shareMailInvalid">
                            Email incorrect !
                        </div>
                        <!-- sending Url -->
                        <div class="share_btn_container">
                            <ul>
                                <li>
                                    <a href="" class="share_btn mail_share" data-ng-click="loadMail()" title="Email"
                                       id="document_share"></a><span class="share-text">Par Email</span></li>
                                <li class="facebook-share"><span class="share-text">Sur
								Facebook</span></li>
                                <li>
                                    <a class="share_link share_btn twitter_share"
                                       href="https://twitter.com/share?url={{envoiUrl}}&via=Accessidys&text=Un élément a été partagé via l'outil Accessidys"
                                       onclick="javascript:window.open(this.href, '', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=300,width=600');return false;"
                                       target="_blank" title="Partager sur Twitter"> </a><span class="share-text">Sur Twitter</span>
                                </li>
                                <li class="google-share">
                                    <button id="google-share" class="share_link share_btn gplus_share"
                                            title="Partager sur Google+"></button>
                                    <span class="share-text">Sur
								Google+</span></li>
                            </ul>
                        </div>
                        <div class="control_group" data-ng-show="displayDestination">
                            <h2>
                                adresse email <br> <span>Saisissez l’adresse email du
							destinataire</span>
                            </h2>
                            <p class="mail_area">
                                <label for="destinataire" class="email" id="label_email_etap-one">Email</label>
                                <input type="text" class="" data-ng-model="destinataire" id="destinataire"
                                       placeholder=""/>
                            </p>
                        </div>
                        <div class="centering" id="ProfileButtons">
                            <button id="reset_shareProfile" type="button" class="reset_btn"
                                    data-ng-click="clearSocialShare()" data-dismiss="modal"
                                    title="{{'Annuler' | translate}}">Annuler
                            </button>
                            <button id="shareProfile" type="button" class="btn_simple light_blue"
                                    data-ng-show="displayDestination" data-ng-click="socialShare()"
                                    title="{{'Partager' | translate}}">Partager
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>


        <div class="modal fade in" id="informationModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel"
             aria-hidden="true">
            <div class="modal-dialog moyen">
                <div class="modal-content">
                    <div class="modal-header">
                        <h3 class="modal-title light_bluehead" id="myModalLabel">information</h3>
                    </div>
                    <div class="modal-body adjust-modal-body">
                        <p class="modal_content-text">Désolé, vous avez été déconnecté de votre compte Google+
                            (probablement dans une autre fenêtre). veuillez vous reconnecter après rafraichissement de
                            la page.</p>
                    </div>
                    <div class="centering">
                        <button type="button" class="btn_simple light_blue much_padding" data-ng-click="reloadPage()">
                            ok
                        </button>
                    </div>
                </div>
            </div>
        </div>


        <div class="modal fade" id="confirmModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel"
             aria-hidden="true" data-backdrop="static" data-keyboard="false">
            <div class="modal-dialog" id="modalContent">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-ng-click="" data-dismiss="modal"
                                aria-hidden="true">&times;</button>
                        <h3 class="modal-title" id="myModalLabel">Confirmation d'envoi</h3>
                    </div>
                    <div class="modal-body adjust-modal-body">
                        <div class="info_txt">
                            <p class="text_left ajustPadding_bottom">Voulez vous envoyer cet email ?</p>
                        </div>
                    </div>
                    <div class="centering" id="confirmationButtons">
                        <button id="restSend_mail_btn" type="button" data-ng-click="clearSocialShare()"
                                class="reset_btn" data-dismiss="modal" title="Annuler">Annuler
                        </button>
                        <button id="send_mail_btn" type="button" class="btn_simple light_blue"
                                data-ng-click="sendMail()" title="Envoyer">Envoyer
                        </button>
                    </div>
                    <!-- /.modal-content -->
                </div>
                <!-- /.modal-dialog -->
            </div>
            <!-- /.modal -->
        </div>

        <div class="fixed_loader" data-ng-show="loader">
            <div class="loadre_container">
                <p class="loader_txt">{{loaderMsg}}</p>
            </div>
        </div>
    </div>
</div>

<img style="visibility:hidden;display:none;" src="https://ga-beacon.appspot.com/UA-69091614-1/profiles?pixel"/>